<?xml version='1.0' encoding='UTF-8'?>

<!--
 $Id: build-tests.xml,v 1.11 2005/01/13 19:57:49 edburns Exp $
-->

<!--
 Copyright 2004 Sun Microsystems, Inc. All rights reserved.
 SUN PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
-->

<!-- ********** JSF System Integration Test File ************************** -->


<project name="JSF-RI-Systest-Execute" default="test" basedir=".">


<!-- =========================== Configuration ============================ -->


  <!-- Load properties in case this script executed directly -->
  <property file="${user.home}/build.properties"/>   <!-- User local        -->
  <property file="build.properties"/>                <!-- Component local   -->
  <property file="../build.properties"/>             <!-- RI local          -->
  <property file="../../build.properties"/>          <!-- Project local     -->

  <!-- SystestClient connection properties -->
  <property name="host"         value="localhost"/>
  <property name="port"         value="8080"/>
  <!-- SystestClient failure handling properties -->
  <property name="failonerror"  value="true"/>
  <!-- Set 'protocol' to a zero length string to use HttpURLConnection -->
  <property name="protocol"     value="HTTP/1.0"/>
  <property name="golden.path"  value="${context.path}/golden"/>
  <property name="ignore.path"  value="${context.path}/ignore"/>
  <property name="local.golden.path" value="${basedir}/web/golden"/>
  <property name="htmlunit.home" value="${tomcat.home}/../htmlunit-1.2.3"/>

  <!-- Default value for debugging arguments is no.  Override in
       build.properties -->
  <property name="debug.jvm.args" value=""/>

  <!-- Test results directory -->
  <property name="test.results.dir" value="../testresults"/>

  <!-- HtmlUnit client classpath -->
  <path id="html.classpath">
    <pathelement location="${junit.jar}"/>
    <pathelement location="../src"/>
    <pathelement location="${webapp.build.home}/WEB-INF/classes"/>
    <fileset dir="${htmlunit.home}/lib">
        <include name="htmlunit-1.2.3.jar"/>
        <include name="commons-httpclient-2.0-beta2.jar"/>
        <include name="xmlParserAPIs-2.2.1.jar"/>
        <include name="commons-logging-1.0.2.jar"/>
        <include name="xercesImpl-2.4.0.jar"/>
        <include name="nekohtml-0.7.7.jar"/>
    </fileset>
  </path>


<!-- ======================== Test Execution ============================== -->


  <target name="test"
   description="Execute all tests against installed applications" >

    <antcall target="test.webapp">
      <param name="webapp.build.home" 
             value="${basedir}/replace-application/build" />
      <param name="webapp.web.home" 
             value="${basedir}/replace-application/web" />
      <param name="source.home" 
             value="${basedir}/replace-application/src/java" />
      <param name="context.path" value="/jsf-replace-application"/>
      <param name="testcase" value="com/sun/faces/systest/ReplaceApplicationTestCase.class"/>

    </antcall>

    <antcall target="test.webapp">
      <param name="webapp.build.home" 
             value="${basedir}/command-link-back-button/build" />
      <param name="webapp.web.home" 
             value="${basedir}/command-link-back-button/web" />
      <param name="source.home" 
             value="${basedir}/command-link-back-button/src/java" />
      <param name="context.path" value="/jsf-command-link-back-button"/>
      <param name="testcase" value="com/sun/faces/systest/CommandLinkBackButtonTestCase.class"/>

    </antcall>

    <antcall target="test.webapp">
      <param name="webapp.build.home" 
             value="${basedir}/unique-view-id/build" />
      <param name="webapp.web.home" 
             value="${basedir}/unique-view-id/web" />
      <param name="source.home" 
             value="${basedir}/unique-view-id/src/java" />
      <param name="context.path" value="/jsf-unique-view-id"/>
      <param name="testcase" value="com/sun/faces/systest/UniqueViewIdTestCase.class"/>

    </antcall>

    <antcall target="test.webapp">
      <param name="webapp.build.home" 
             value="${basedir}/nested-datatables/build" />
      <param name="webapp.web.home" 
             value="${basedir}/nested-datatables/web" />
      <param name="source.home" 
             value="${basedir}/nested-datatables/src/java" />
      <param name="context.path" value="/jsf-nested-datatables"/>
      <param name="testcase" value="com/sun/faces/systest/NestedDatatablesTestCase.class"/>

    </antcall>

    <antcall target="test.webapp">
      <param name="webapp.build.home" 
             value="${basedir}/core-tags/build" />
      <param name="webapp.web.home" 
             value="${basedir}/core-tags/web" />
      <param name="source.home" 
             value="${basedir}/core-tags/src/java" />
      <param name="context.path" value="/jsf-core-tags"/>
      <param name="testcase" value="com/sun/faces/systest/CoreTagsTestCase.class"/>

    </antcall>

    <antcall target="test.webapp">
      <param name="webapp.build.home" 
             value="${basedir}/replace-lifecycle/build" />
      <param name="webapp.web.home" 
             value="${basedir}/replace-lifecycle/web" />
      <param name="source.home" 
             value="${basedir}/replace-lifecycle/src/java" />
      <param name="context.path" value="/jsf-replace-lifecycle"/>
      <param name="testcase" value="com/sun/faces/systest/ReplaceLifecycleTestCase.class"/>

    </antcall>

  </target>

  <target name="test.webapp"
   description="Test a single webapp, given a context.path, webapp.build.home, and testcase">

    <junit printsummary="yes" fork="yes"
          haltonfailure="yes" haltonerror="yes">

      <!-- uncomment the below line to enable attaching a debugger -->
      <jvmarg line="${debug.jvm.args}"/>

      <classpath refid="html.classpath"/>
      <formatter  type="plain"      usefile="false"/>
      <formatter  type="xml"        usefile="true"/>
      <sysproperty key="host"         value="${host}"/>
      <sysproperty key="port"         value="${port}"/>
      <sysproperty key="context.path" value="${context.path}"/>

      <!-- Uncomment the following for wire-level debugging -->
      <!-- NOTE:  this requires a hacked htmlunit-1.2.3.jar -->
<!--
      <sysproperty key="org.apache.commons.logging.Log"
                 value="org.apache.commons.logging.impl.SimpleLog"/>
      <sysproperty key="org.apache.commons.logging.simplelog.log.httpclient.wire"
                 value="debug"/>
-->
<!--
      <sysproperty key="org.apache.commons.logging.simplelog.showdatetime"
                 value="true"/>
-->

      <batchtest todir="${test.results.dir}">
        <fileset    dir="${webapp.build.home}/WEB-INF/classes"
               includes="${testcase}"/>
      </batchtest>

    </junit>

  </target>
    
</project>
