<?xml version="1.0"?>

<!--
 Copyright 2003 Sun Microsystems, Inc. All rights reserved.
 SUN PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.

 $Id: build-tests.xml,v 1.15 2003/08/14 22:40:10 jvisvanathan Exp $
-->


<!-- ********** JSF System Integration Test File ************************** -->


<project name="JSF-RI-Systest-Execute" default="test" basedir=".">


<!-- =========================== Configuration ============================ -->


  <!-- SystestClient connection properties -->
  <property name="context.path" value="/jsf-systest"/>
  <property name="host"         value="localhost"/>
  <property name="port"         value="8080"/>
  <!-- Set 'protocol' to a zero length string to use HttpURLConnection -->
  <property name="protocol"     value="HTTP/1.0"/>
  <property name="golden.path"  value="${context.path}/golden"/>
  <property name="ignore.path"  value="${context.path}/ignore"/>
  <property name="local.golden.path" value="${basedir}/web/golden"/>


  <!-- SystestClient taskdef classpath -->
  <path id="test.classpath">
    <pathelement location="${ant.home}/lib/ant.jar"/>
    <pathelement location="${basedir}/build/WEB-INF/classes"/>
    <pathelement location="${commons-logging.jar}"/>
  </path>


  <!-- SystestClient taskdef declaration -->
  <taskdef  name="tester"
       classname="com.sun.faces.systest.ant.SystestClient">
    <classpath refid="test.classpath" />
  </taskdef>


<!-- ======================== Test Execution ============================== -->


  <target name="test"
   description="Execute all tests against installed application"
       depends="test.hello,
                test.external,
                test.managed,
                test.message,
                test.converter,
                test.converter01,
                test.validator,
                test.validator01,
                test.component,
                test.component01,
                test.navigation,
                test.tlvalidator,
                test.standard,
                test.html.taglib
               "/>


  <target name="test.external"
   description="Test ExternalContext implementation issues">

    <!-- Request scope attribute transparency -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/external01.jsp"
      outContent="/external01.jsp PASSED"/>

    <!-- Session scope attribute transparency -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/external02.jsp"
      outContent="/external02.jsp PASSED"/>

    <!-- Application scope attribute transparency -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/external03.jsp"
      outContent="/external03.jsp PASSED"/>

  </target>


  <target name="test.hello"
   description="Basic Hello, World Tests">

    <!-- Simple Non-Faces Response -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/hello.jsp" status="200"
      outContent="/hello.jsp PASSED"/>

    <!-- Simple Faces Response (Indirect) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/facesResponse.jsp?responseTreeId=/hello.jsp"
      outContent="/hello.jsp PASSED"/>

    <!-- Simple Faces Response (Direct) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/hello.jsp"
      outContent="/hello.jsp PASSED"/>

    <!-- Simple Golden File Test -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/hello.jsp"
          golden="${golden.path}/hello.txt"/>

    <!-- Simple Golden File Plus Ignore File Test -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/hello.jsp"
          golden="${golden.path}/hello-mismatch.txt"
          ignore="${ignore.path}/hello-mismatch.txt"/>

  </target>


  <target name="test.managed"
   description="Test managed bean creation facility">

    <!-- Managed Bean Create #1 (No Property Setters) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/managed01.jsp"
      outContent="/managed01.jsp PASSED"/>

    <!-- Managed Bean Create #2 (Primitive Property Setters) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/managed02.jsp"
      outContent="/managed02.jsp PASSED"/>

  </target>



  <target name="test.message"
   description="Test message resources processing">

    <!-- Standard API Message Resources -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message01.jsp"
      outContent="/message01.jsp PASSED"/>

    <!-- Standard IMPL Message Resources -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message02.jsp"
      outContent="/message02.jsp PASSED"/>

    <!-- Single Message Resources Element -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message03.jsp"
      outContent="/message03.jsp PASSED"/>

    <!-- Double Message Resources Element -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message04.jsp"
      outContent="/message04.jsp PASSED"/>

  </target>

  <target name="test.navigation"
   description="Test navigation handler rule processing">

  </target>

  <target name="test.tlvalidator"
   description="Test the RI Tag Library Validator">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestHtmlBasicValidatorFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestHtmlBasicValidatorSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIfFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIfSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIteratorFail.jsp"
      status="500"/>
    <!-- PENDING (horwat,rlubke) Disabled until JSP 'id' issue is resolved. 
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIteratorSucceed.jsp"
      status="200"/> -->

  </target>
  
  <target name="test.converter"
   description="Test Converter creation facility">

    <!-- Test Converter creation -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/converter.jsp"
      outContent="/converter.jsp PASSED"/>
  </target>
  
  <target name="test.converter01"
   description="Test standard Converter replacement">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/converter01.jsp"
      outContent="/converter01.jsp PASSED"/>
  </target>
  
  <target name="test.validator"
   description="Test Validator creation facility">

    <!-- Test validator creation -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/validator.jsp"
      outContent="/validator.jsp PASSED"/>
  </target>
  
  <target name="test.validator01"
   description="Test standard Validator replacement">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/validator01.jsp"
      outContent="/validator01.jsp PASSED"/>
  </target>
  
  <target name="test.component"
   description="Test Component creation facility">

    <!-- Test Component creation -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/component.jsp"
      outContent="/component.jsp PASSED"/>
  </target>
  
  <target name="test.component01"
   description="Test standard Component replacement">

   <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/component01.jsp"
      outContent="/component01.jsp PASSED"/>
  </target>

  <target name="test.standard"
          description="Test the Standard RenderKit">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/standard/output_errors01.jsp"
          golden="${golden.path}/standard/output_errors01.txt"/>
          
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/standard/componentRef01.jsp"
         golden="${golden.path}/standard/componentRef01.txt"/>
  </target>

  <target name="test.html.taglib"
          description="Test the HTML JSP Tags">
      <echo message="Testing command_button..."/>
      <tester host="${host}" port="${port}" protocol="${protocol}"
              request="${context.path}/faces/taglib/command_button_test.jsp"
              golden="${golden.path}/taglib/command_button_test.txt"/>

      <echo message="Testing command_hyperlink..."/>
      <tester host="${host}" port="${port}" protocol="${protocol}"
              request="${context.path}/faces/taglib/command_hyperlink_test.jsp"
              golden="${golden.path}/taglib/command_hyperlink_test.txt"/>
  </target>

</project>
