<?xml version="1.0"?>

<!--
 Copyright 2003 Sun Microsystems, Inc. All rights reserved.
 SUN PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.

 $Id: build-tests.xml,v 1.27 2003/10/07 20:59:47 jvisvanathan Exp $
-->


<!-- ********** JSF System Integration Test File ************************** -->


<project name="JSF-RI-Systest-Execute" default="test" basedir=".">


<!-- =========================== Configuration ============================ -->


  <!-- Load properties in case this script executed directly -->
  <property file="build.properties"/>
  <property file="../build.properties"/>
  <property file="${user.home}/build.properties"/>

  <!-- SystestClient connection properties -->
  <property name="context.path" value="/jsf-systest"/>
  <property name="host"         value="localhost"/>
  <property name="port"         value="8080"/>
  <!-- Set 'protocol' to a zero length string to use HttpURLConnection -->
  <property name="protocol"     value="HTTP/1.0"/>
  <property name="golden.path"  value="${context.path}/golden"/>
  <property name="ignore.path"  value="${context.path}/ignore"/>
  <property name="local.golden.path" value="${basedir}/web/golden"/>


  <!-- SystestClient taskdef classpath -->
  <path id="test.classpath">
    <pathelement location="${ant.home}/lib/ant.jar"/>
    <pathelement location="${basedir}/build/WEB-INF/classes"/>
    <pathelement location="${commons-logging.jar}"/>
  </path>


  <!-- SystestClient taskdef declaration -->
  <taskdef  name="tester"
       classname="com.sun.faces.systest.ant.SystestClient">
    <classpath refid="test.classpath" />
  </taskdef>


  <!-- HtmlUnit client classpath -->
  <path id="html.classpath">
    <pathelement location="${junit.jar}"/>
    <pathelement location="${basedir}/build/WEB-INF/classes"/>
    <fileset dir="${htmlunit.home}/lib" includes="*.jar"/>
  </path>


<!-- ======================== Test Execution ============================== -->


  <target name="test"
   description="Execute all tests against installed application"
       depends="test.duplicateIds,
                test.renderkit,
                test.hello,
                test.external,
                test.managed,
                test.message,
                test.converter,
                test.converter01,
                test.converter02,
                test.validator,
                test.validator01,
                test.component,
                test.component01,
                test.navigation,
                test.tlvalidator,
                test.standard,
                test.html.taglib,
                test.verbatim,
                test.phases,
                test.subview
               "/>

<!-- non running tests 
                test.jsp,
-->

    <target name="test.duplicateIds"
        description="Test duplicate ID detection">
    
        <tester host="${host}" port="${port}" protocol="${protocol}"
            request="${context.path}/faces/duplicateIds01.jsp"
             status="200"/>
        
        <tester host="${host}" port="${port}" protocol="${protocol}"
            request="${context.path}/faces/duplicateIds02.jsp"
             status="200"/>
        
        <tester host="${host}" port="${port}" protocol="${protocol}"
            request="${context.path}/faces/duplicateIds03.jsp"
             status="200"/>
    </target>

  <target name="test.external"
   description="Test ExternalContext implementation issues">

    <!-- Request scope attribute transparency -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/external01.jsp"
      outContent="/external01.jsp PASSED"/>

    <!-- Session scope attribute transparency -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/external02.jsp"
      outContent="/external02.jsp PASSED"/>

    <!-- Application scope attribute transparency -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/external03.jsp"
      outContent="/external03.jsp PASSED"/>

  </target>


  <target name="test.hello"
   description="Basic Hello, World Tests">

    <!-- Simple Non-Faces Response -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/hello.jsp" status="200"
      outContent="/hello.jsp PASSED"/>

    <!-- Simple Faces Response (Indirect) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/facesResponse.jsp?responseViewId=/hello.jsp"
      outContent="/hello.jsp PASSED"/>

    <!-- Simple Faces Response (Direct) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/hello.jsp"
      outContent="/hello.jsp PASSED"/>

    <!-- Simple Golden File Test -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/hello.jsp"
          golden="${golden.path}/hello.txt"/>

    <!-- Simple Golden File Plus Ignore File Test -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/hello.jsp"
          golden="${golden.path}/hello-mismatch.txt"
          ignore="${ignore.path}/hello-mismatch.txt"/>

  </target>


  <target name="test.jsp"
   description="Test JSP Integration">

    <junit printsummary="yes" fork="no"
          haltonfailure="yes" haltonerror="yes">

      <classpath refid="html.classpath"/>
      <formatter  type="plain"      usefile="false"/>
      <sysproperty key="host"         value="${host}"/>
      <sysproperty key="port"         value="${port}"/>
      <sysproperty key="context.path" value="${context.path}"/>

      <!-- Uncomment the following for wire-level debugging -->
      <!-- NOTE:  this requires a hacked htmlunit-1.2.3.jar -->
<!--
      <sysproperty key="org.apache.commons.logging.Log"
                 value="org.apache.commons.logging.impl.SimpleLog"/>
      <sysproperty key="org.apache.commons.logging.simplelog.log.httpclient.wire"
                 value="debug"/>
-->
<!--
      <sysproperty key="org.apache.commons.logging.simplelog.showdatetime"
                 value="true"/>
-->

      <batchtest>
        <fileset    dir="${basedir}/build/WEB-INF/classes"
               includes="com/sun/faces/jsptest/*TestCase.class"/>
      </batchtest>

    </junit>

  </target>


  <target name="test.managed"
   description="Test managed bean creation facility">

    <!-- Managed Bean Create #1 (No Property Setters) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/managed01.jsp"
      outContent="/managed01.jsp PASSED"/>

    <!-- Managed Bean Create #2 (Primitive Property Setters) -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/managed02.jsp"
      outContent="/managed02.jsp PASSED"/>

  </target>



  <target name="test.message"
   description="Test message resources processing">

    <!-- Standard API Message Resources -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message01.jsp"
      outContent="/message01.jsp PASSED"/>

    <!-- Standard IMPL Message Resources -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message02.jsp"
      outContent="/message02.jsp PASSED"/>

    <!-- Single Message Resources Element -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message03.jsp"
      outContent="/message03.jsp PASSED"/>

    <!-- Double Message Resources Element -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/message04.jsp"
      outContent="/message04.jsp PASSED"/>

  </target>

  <target name="test.navigation"
   description="Test navigation handler rule processing">

  </target>

  <target name="test.tlvalidator"
   description="Test the RI Tag Library Validator">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestHtmlBasicValidatorFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestHtmlBasicValidatorSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIfFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIfSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIteratorFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestCoreValidatorIteratorSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestElValidatorActionRefFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestElValidatorActionRefSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/TestElValidatorComponentRefFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
   	 request="${context.path}/faces/TestElValidatorComponentRefSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
    	 request="${context.path}/faces/TestElValidatorIdFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
    	 request="${context.path}/faces/TestElValidatorIdSucceed.jsp"
      status="200"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
    	 request="${context.path}/faces/TestElValidatorValueRefFail.jsp"
      status="500"/>

    <tester host="${host}" port="${port}" protocol="${protocol}"
    	 request="${context.path}/faces/TestElValidatorValueRefSucceed.jsp"
      status="200"/>

  </target>
  
  <target name="test.converter"
   description="Test Converter creation facility">

    <!-- Test Converter creation -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/converter.jsp"
      outContent="/converter.jsp PASSED"/>
  </target>
  
  <target name="test.converter01"
   description="Test standard Converter replacement">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/converter01.jsp"
      outContent="/converter01.jsp PASSED"/>
  </target>

  <target name="test.converter02"
   description="Test passing Converter instances to component tag">
   
   <tester host="${host}" port="${port}" protocol="${protocol}"
        request="${context.path}/faces/converter02.jsp"
        golden="${golden.path}/standard/converter02.txt"/>
  </target>
  
  <target name="test.validator"
   description="Test Validator creation facility">

    <!-- Test validator creation -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/validator.jsp"
      outContent="/validator.jsp PASSED"/>
  </target>
  
  <target name="test.validator01"
   description="Test standard Validator replacement">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/validator01.jsp"
      outContent="/validator01.jsp PASSED"/>
  </target>
  
  <target name="test.component"
   description="Test Component creation facility">

    <!-- Test Component creation -->
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/component.jsp"
      outContent="/component.jsp PASSED"/>
  </target>
  
  <target name="test.component01"
   description="Test standard Component replacement">

   <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/component01.jsp"
      outContent="/component01.jsp PASSED"/>
  </target>

  <target name="test.standard"
          description="Test the Standard RenderKit">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/standard/output_errors01.jsp"
          golden="${golden.path}/standard/output_errors01.txt"/>
          
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/standard/componentRef01.jsp"
         golden="${golden.path}/standard/componentRef01.txt"/>
  </target>

  <target name="test.html.taglib"
          description="Test the HTML JSP Tags">
      <echo message="Testing command_button..."/>
      <tester host="${host}" port="${port}" protocol="${protocol}"
              request="${context.path}/faces/taglib/command_button_test.jsp"
              golden="${golden.path}/taglib/command_button_test.txt"/>

<!-- PENDING horwat: JSFA86 changes break this test
      <echo message="Testing command_hyperlink..."/>
      <tester host="${host}" port="${port}" protocol="${protocol}"
              request="${context.path}/faces/taglib/command_hyperlink_test.jsp"
              golden="${golden.path}/taglib/command_hyperlink_test.txt"/>
-->
  </target>

  <target name="test.verbatim"
          description="Test the Verbatim tag">
      <echo message="Testing verbatim..."/>
      <tester host="${host}" port="${port}" protocol="${protocol}"
              request="${context.path}/faces/verbatim_test.jsp"
              golden="${golden.path}/verbatim_test.txt"/>
      <echo message="Testing verbatim..."/>
  </target>


  <target name="test.renderkit"
   description="Test renderkit processing">
   <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/renderkit01.jsp"
      outContent="/renderkit01.jsp PASSED"/>
   <tester host="${host}" port="${port}" protocol="${protocol}"
        request="${context.path}/renderkit02.jsp"
	golden="${golden.path}/renderkit02A.txt"/>
   <tester host="${host}" port="${port}" protocol="${protocol}"
        request="${context.path}/renderkit03.jsp"
	golden="${golden.path}/renderkit03A.txt"/>
  </target>

  <target name="test.phases"
   description="Test Phase processing with Phase Listener">
   <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/phaseListener01.jsp"
         outContent="/phaseListener01.jsp PASSED"/>
   <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/phaseListener01.jsp?param=foo"
         outContent="/phaseListener01.jsp FAILED"/>
  </target>
  <target name="test.subview"
          description="Test subview tag">

    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/subview01.jsp"
          golden="${golden.path}/subview01.txt"/>
          
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/subview02.jsp"
         golden="${golden.path}/subview02.txt"/>
         
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/subview03.jsp"
         golden="${golden.path}/subview03.txt"/>
         
    <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/subview04.jsp"
         golden="${golden.path}/subview04.txt"/>
         
     <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/subview05.jsp"
         golden="${golden.path}/subview05.txt"/>
         
     <tester host="${host}" port="${port}" protocol="${protocol}"
         request="${context.path}/faces/subview06.jsp"
         golden="${golden.path}/subview06.txt"/>
  </target>
</project>
